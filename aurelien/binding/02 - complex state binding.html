<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>#1 Simple state Binding</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

</head>

<body>

    <h2>#1.2 Complex state Binding</h2>

    <strong>State</strong>
    <pre>
        <code>
    const state = {
        user: {
            firstname: 'Aurélien',
            lastname: 'Loyer',
            jobs: [
                'Zenika Lille',
                'Zenika Montreal'
            ]
        },
        title: 'Présentation'
    }
        </code>
    </pre>

    <strong>Result</strong>

    <div class="app">
        <h3 data-value="title"></h3>
        <p data-value="user.jobs[1]"></p>
        <p data-value="user.firstname"></p>
        <p data-value="user.lastname"></p>
    </div>

    <script>
        const state = {
            user: {
                firstname: 'Aurélien',
                lastname: 'Loyer',
                jobs: [
                    'Zenika Lille',
                    'Zenika Montreal'
                ]
            },
            title: 'Présentation'
        }

        const app = document.querySelector('.app');

        function getStateValue(state, key) {
            console.log(state);
            console.log(key);
            return state[key];
        }
        
        function bind(app, state) {
            var elements = app.querySelectorAll('[data-value]');
            elements.forEach((element) => {
                let key = element.getAttribute('data-value');
                let value = getStateValue(state, key);
                updateElement(element,value);
                // and define setter for next object update
                Object.defineProperty(state, key, { set: function (newValue) { updateElement(element, newValue); } });
            });
        }

        function updateElement(element, value) {
            element.innerText = value;
        }

        bind(app, state);

    </script>

</body>

</html>
