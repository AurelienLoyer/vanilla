<html xmlns:z-bind="http://www.w3.org/1999/xhtml">
<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css"/>
</head>
<body>

<h2>Binding</h2>

<div id="app">
  <div>
    <p>
      <img height="height" alt="lastname" src="https://tinyurl.com/ycu98mke"/>
    </p>
    <p title="firstname">test title</p>
    <input value="John" title="lastname"/>
    <input value="Doe"/><br/>

    <input value="32"/>
    <input value="US"/><br/>

    <input value="Texas"/>
    <input value="Paris"/><br/>

  </div>


  <div>
    <p>
      <img z-bind:height="height" z-bind:alt="lastname" z-bind:src="avatar"/>
    </p>
    <p z-bind:title="firstname">test title</p>
    <input z-bind:value="firstname" z-bind:title="lastname"/>
    <input z-bind:value="lastname"/><br/>

    <input z-bind:value="age"/>
    <input z-bind:value="country"/><br/>

    <input z-bind:value="city"/>
    <input z-bind:value="street"/><br/>
  </div>


</div>
</div>
<script>

    let state = {
        title: "DevFest",
        firstname: "Emmanuel",
        lastname: "Demey",
        age: 39,
        country: "France",
        city: "Lille",
        street: "262 rue Brendan Eich",
        avatar: "https://pbs.twimg.com/profile_images/799175687097688064/Y2TWhwYL_400x400.jpg"
    }


    function bind(app, state) {
        const bindPattern = 'z-bind:';
        const bindSugarPattern = ':';
        const attributeRegex = new RegExp(`\^${bindPattern}|${bindSugarPattern}`);
        const flatChildren = app.querySelectorAll('*');
        flatChildren.forEach((element) => {
            Object.values(element.attributes).forEach((attribute) => {
                if (attributeRegex.test(attribute.localName) && attribute.specified) {
                    const attributeName = attribute.localName.replace(attributeRegex, '')
                    element.setAttribute(attributeName, state[attribute.value]);
                }
            })
        });
    }


    state = bind(document.getElementById('app'), state);

</script>
</body>
</html>
